fragment userDetailFragment on users {
  name
  email
  familyName
  givenName
  imageUrl
  memberships:membershipssByuserId{
    active
    roles:rolesByroleId{
      id
      name
    }
  }
}
query AdminPageQuery {
  users:v_user_info_3(where:{_not:{detail:{name:{_eq:"Guest"}}}}){
    value:user_id
    label:name
    permissions
    roles
    detail{
      ...userDetailFragment
    }
  }
  roles:v_role_info{
    value:role_id
    label:role_name
    permissions
    permission_ids
    memberships:memberships_r_aggregate{
      aggregate{
        count
      }
      nodes{
        id
        active
        user_info{
          detail{
            ...userDetailFragment
          }
        }
      }
    }
  }
  permissions{
    value:id
    label:name
  }
  roles_details:roles(where:{_not:{name:{_eq:"guest"}}}){
    id
    name
    permissions:rolePermissionssByroleId{
      id:permission_id      
      detail:permissionsBypermissionId{
        name
      }
    }
    memberships:membershipssByroleId{
      user_id
      active
    }
  }
}
